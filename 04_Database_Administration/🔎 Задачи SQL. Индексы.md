# üîé –ó–∞–¥–∞—á–∏ SQL. –ò–Ω–¥–µ–∫—Å—ã

## üóÑÔ∏è –¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE `workers` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `first_name` varchar(20) NOT NULL DEFAULT '',
  `last_name` varchar(20) NOT NULL DEFAULT '',
  `company` varchar(50) NOT NULL DEFAULT '',
  `role` varchar(30) NOT NULL DEFAULT '',
  `number` smallint(6) unsigned NOT NULL,
  `series` mediumint(11) unsigned NOT NULL,
  `birthday` date NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:** 979,991

---

## –ó–∞–¥–∞–Ω–∏–µ 1

**–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Å–µ—Ä–∏–µ–π –ø–∞—Å–ø–æ—Ä—Ç–∞ 1015 –∏ –Ω–æ–º–µ—Ä–æ–º 422269**

```sql
SELECT * FROM workers WHERE series = 1015 AND number = 422269;
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_series_number ON workers(series, number);
```
–ò–ª–∏ —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å, –≥–¥–µ series –∏–¥–µ—Ç –ø–µ—Ä–≤—ã–º, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏–º–µ–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
</details>

---

## –ó–∞–¥–∞–Ω–∏–µ 2

**–ù–∞–π—Ç–∏ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∏–º–µ–Ω–µ–º –ê–ª–µ–∫—Å–µ–π c –¥–∞—Ç–æ–π —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ 1 –∏—é–ª—è 1999 –≥–æ–¥–∞**

```sql
SELECT * FROM workers 
WHERE first_name = '–ê–ª–µ–∫—Å–µ–π' AND birthday > '1999-07-01';
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_first_name_birthday ON workers(first_name, birthday);
```
–ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ –Ω–∏—Ö.
</details>

---

## –ó–∞–¥–∞–Ω–∏–µ 3

**–ù–∞–π—Ç–∏ –∫–æ–º–ø–∞–Ω–∏—é –≤ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ú–∞—Ç–≤–µ–π –ë–∞—Ä—Å—É–∫–æ–≤**

```sql
SELECT company FROM workers 
WHERE first_name = '–ú–∞—Ç–≤–µ–π' AND last_name = '–ë–∞—Ä—Å—É–∫–æ–≤' AND role = '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç';
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_name_role ON workers(first_name, last_name, role);
```
–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π –≤—Å–µ —Ç—Ä–∏ –ø–æ–ª—è —É—Å–ª–æ–≤–∏—è WHERE.
</details>

---

## –ó–∞–¥–∞–Ω–∏–µ 4

**–ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏ 'C–µ–≤–µ—Ä—Å—Ç–∞–ª—å'**

```sql
SELECT COUNT(*) FROM workers WHERE company = 'C–µ–≤–µ—Ä—Å—Ç–∞–ª—å';
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_company ON workers(company);
```
–ü—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ company –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
</details>

---

## –ó–∞–¥–∞–Ω–∏–µ 5

**–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ —Å –¥–∞—Ç–æ–π —Ä–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É 1 –¥–µ–∫–∞–±—Ä—è 1979 –∏ 1 —Ñ–µ–≤—Ä–∞–ª—è 1980, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏**

```sql
SELECT * FROM workers 
WHERE role = '–∏–Ω–∂–µ–Ω–µ—Ä' 
  AND birthday BETWEEN '1979-12-01' AND '1980-02-01'
ORDER BY first_name, last_name;
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_role_birthday_names ON workers(role, birthday, first_name, last_name);
```
–ò–Ω–¥–µ–∫—Å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É.
</details>

---

## –ó–∞–¥–∞–Ω–∏–µ 6

**–í—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º–∏ –•–∏–º–∏–∫-—Ç–µ—Ö–Ω–æ–ª–æ–≥, –•–∏–º–∏–∫ –∏ –ë–∏–æ—Ö–∏–º–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ X5 Retail Group –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è - –æ—Ç –º–æ–ª–æ–¥—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º**

```sql
SELECT * FROM workers 
WHERE company = 'X5 Retail Group' 
  AND role IN ('–•–∏–º–∏–∫-—Ç–µ—Ö–Ω–æ–ª–æ–≥', '–•–∏–º–∏–∫', '–ë–∏–æ—Ö–∏–º–∏–∫')
ORDER BY birthday DESC;
```

<details>
<summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É</summary>

```sql
CREATE INDEX idx_company_role_birthday ON workers(company, role, birthday);
```
–ò–Ω–¥–µ–∫—Å –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ company –∏ role —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ birthday.
</details>

---

## üìä –°–ø—Ä–∞–≤–∫–∞ –ø–æ EXPLAIN

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ EXPLAIN:

- **type** - —Ç–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–≤–∞–∂–Ω—ã: const, eq_ref, ref, range; –∏–∑–±–µ–≥–∞—Ç—å: ALL)
- **key** - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–Ω–¥–µ–∫—Å
- **rows** - –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö —Å—Ç—Ä–æ–∫
- **Extra** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
  - `Using where` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
  - `Using index` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å
  - `Using filesort` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - `Using temporary` - —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

### –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏:
- **type**: ref, eq_ref, const
- **rows**: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- **key**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∏–Ω–¥–µ–∫—Å
- **Extra**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Using filesort –∏ Using temporary

---

## üõ†Ô∏è –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–¥–µ–∫—Å–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
```sql
SHOW INDEX FROM workers;
-- –∏–ª–∏
SHOW KEYS FROM workers;
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
-- –ü—Ä–æ—Å—Ç–æ–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_column ON table_name(column_name);

-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE UNIQUE INDEX idx_unique_column ON table_name(column_name);

-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_multiple ON table_name(col1, col2, col3);
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
DROP INDEX index_name ON table_name;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞
```sql
EXPLAIN SELECT * FROM workers WHERE first_name = '–ò–≤–∞–Ω';
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```sql
-- –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
SET profiling = 1;

-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
SELECT * FROM workers WHERE company = '–ì–∞–∑–ø—Ä–æ–º';

-- –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø—Ä–æ—Å–∞
SHOW PROFILES;

-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É
SHOW PROFILE FOR QUERY 1;
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
ANALYZE TABLE workers;
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
-- –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
SET GLOBAL userstat=1;

-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT * FROM INFORMATION_SCHEMA.INDEX_STATISTICS 
WHERE TABLE_NAME = 'workers';
```

**–í–∞–∂–Ω–æ:** –ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç —á—Ç–µ–Ω–∏–µ, –Ω–æ –∑–∞–º–µ–¥–ª—è—é—Ç –≤—Å—Ç–∞–≤–∫—É/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã!